<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPX Shopping Center | متجر الشراء الحقيقي</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <style>
        :root { --amazon-orange: #ff9900; --amazon-blue: #232f3e; --bg: #f3f3f3; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; direction: rtl; }
        nav { background: var(--amazon-blue); padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; color: white; }
        .container { padding: 20px; display: flex; gap: 20px; flex-wrap: wrap; }
        .main-content { flex: 3; min-width: 300px; }
        .sidebar { flex: 1; background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd; min-width: 250px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .product-card { background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd; text-align: center; }
        .product-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 4px; }
        .price { font-size: 1.2rem; font-weight: bold; color: #B12704; margin: 10px 0; }
        .btn-add { background: #ffd814; border: 1px solid #fcd200; border-radius: 8px; padding: 8px; width: 100%; cursor: pointer; }
        .btn-order { background: var(--amazon-orange); border: 1px solid #a88734; border-radius: 8px; padding: 12px; width: 100%; cursor: pointer; font-weight: bold; margin-top: 20px; }
        input, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        #login-page { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; background: white; }
    </style>
</head>
<body>

    <div id="login-page">
        <h1>مرحباً بك في متجر NPX</h1>
        <button onclick="login()" style="padding: 12px 24px; cursor: pointer; border-radius: 25px;">الدخول بحساب Google</button>
    </div>

    <div id="shop-page" style="display: none;">
        <nav>
            <div style="font-size: 1.5rem;">NPX Mall</div>
            <button onclick="logout()" style="background: none; color: white; border: 1px solid white; cursor: pointer;">خروج</button>
        </nav>

        <div class="container">
            <div class="main-content">
                <div class="grid" id="products"></div>
            </div>

            <div class="sidebar">
                <h3>سلة المشتريات</h3>
                <div id="cart-items">السلة فارغة</div>
                <div class="price">الإجمالي: <span id="total-price">0.00</span> $</div>

                <div style="margin-top: 20px; background: #fefefe; padding: 10px; border: 1px solid #eee;">
                    <h4>بيانات التوصيل</h4>
                    <label>رقم الهاتف:</label>
                    <input type="tel" id="user-phone" placeholder="01xxxxxxxxx">
                    <label>العنوان بالكامل:</label>
                    <textarea id="user-address" rows="3" placeholder="المدينة، الشارع، رقم الشقة"></textarea>
                    <button class="btn-order" onclick="placeOrder()">تأكيد الشراء الفعلي</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // إعدادات Firebase الخاصة بك
        const firebaseConfig = {
            apiKey: "AIzaSyAVadEAFdmh0SuWq4sZJkSJJrRpF5fOp58",
            authDomain: "authen-36a1f.firebaseapp.com",
            projectId: "authen-36a1f",
            databaseURL: "https://authen-36a1f-default-rtdb.firebaseio.com/", // ستحتاج لتفعيلها في لوحة التحكم
            storageBucket: "authen-36a1f.firebasestorage.app",
            messagingSenderId: "144619996396",
            appId: "1:144619996396:web:21c057f485099f574bd1c9"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const provider = new firebase.auth.GoogleAuthProvider();

        const items = [
            { id: 1, name: "آيفون 15 برو", price: 999.00, img: "https://images.unsplash.com/photo-1696446701796-da61225697cc?w=400" },
            { id: 2, name: "ساعة آبل الذكية", price: 399.00, img: "https://images.unsplash.com/photo-1546868871-70c122469d8b?w=400" },
            { id: 3, name: "سماعات سوني لاسلكية", price: 250.00, img: "https://images.unsplash.com/photo-1546435770-a3e426bf472b?w=400" }
        ];

        let cart = [];

        function login() { auth.signInWithPopup(provider); }
        function logout() { auth.signOut(); }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('shop-page').style.display = 'block';
                renderProducts();
            } else {
                document.getElementById('login-page').style.display = 'flex';
                document.getElementById('shop-page').style.display = 'none';
            }
        });

        function renderProducts() {
            document.getElementById('products').innerHTML = items.map(p => `
                <div class="product-card">
                    <img src="${p.img}">
                    <h3>${p.name}</h3>
                    <div class="price">${p.price}$</div>
                    <button class="btn-add" onclick="addToCart(${p.id})">إضافة للسلة</button>
                </div>
            `).join('');
        }

        function addToCart(id) {
            const item = items.find(p => p.id === id);
            cart.push(item);
            updateCart();
        }

        function updateCart() {
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            document.getElementById('cart-items').innerHTML = cart.map(item => `<div>• ${item.name}</div>`).join('');
            document.getElementById('total-price').innerText = total.toFixed(2);
        }

        function placeOrder() {
            const phone = document.getElementById('user-phone').value;
            const address = document.getElementById('user-address').value;

            if (cart.length === 0 || !phone || !address) return alert("يرجى إكمال البيانات والسلة!");

            // حفظ الطلب في Firebase Database
            const orderId = Date.now();
            database.ref('orders/' + orderId).set({
                customerName: auth.currentUser.displayName,
                customerEmail: auth.currentUser.email,
                phone: phone,
                address: address,
                items: cart,
                total: document.getElementById('total-price').innerText,
                status: "قيد المراجعة"
            }).then(() => {
                alert("تم إرسال طلبك بنجاح! سنتواصل معك قريباً.");
                cart = [];
                updateCart();
                document.getElementById('user-phone').value = "";
                document.getElementById('user-address').value = "";
            }).catch(err => alert("حدث خطأ: " + err.message));
        }
    </script>
</body>
</html>
