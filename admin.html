<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPX Admin - Ultimate Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --p: #6366f1; --dark: #0f172a; --bg: #f1f5f9; --white: #ffffff; --red: #ef4444; --green: #22c55e; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 20px; direction: rtl; }
        
        /* Dashboard Stats */
        .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-box { background: var(--white); padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-bottom: 4px solid var(--p); }
        .stat-box h2 { margin: 10px 0; font-size: 2rem; color: var(--dark); }

        .main-container { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; }
        @media (max-width: 1100px) { .main-container { grid-template-columns: 1fr; } }

        .box { background: var(--white); padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* Forms */
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; outline: none; box-sizing: border-box; }
        .size-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .btn-p { background: var(--p); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-p:hover { background: #4f46e5; }

        /* Drag & Drop */
        #drop-zone { border: 2px dashed var(--p); padding: 25px; text-align: center; border-radius: 12px; cursor: pointer; background: #f8fafc; color: #64748b; }
        #preview { max-width: 100%; height: 150px; object-fit: contain; display: none; margin: 10px auto; border-radius: 8px; }

        /* Orders Card */
        .order-card { background: var(--white); padding: 20px; border-radius: 12px; margin-bottom: 15px; border-right: 6px solid var(--p); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .item-row { background: #f8fafc; padding: 8px 12px; border-radius: 8px; margin: 5px 0; display: flex; justify-content: space-between; font-size: 0.95rem; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .badge-pending { background: #fef3c7; color: #92400e; }
        .badge-done { background: #dcfce7; color: #166534; }
        
        .actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-success { background: var(--green); flex: 2; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
        .btn-danger { background: var(--red); flex: 1; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="stats-bar">
        <div class="stat-box"><h3>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3><h2 id="totalMoney">$0</h2></div>
        <div class="stat-box"><h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3><h2 id="totalOrders">0</h2></div>
        <div class="stat-box"><h3>Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</h3><h2 id="totalItems">0</h2></div>
    </div>

    <div class="main-container">
        <div class="box">
            <h2><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h2>
            <input id="n" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input id="pr" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± $">
            
            <p style="margin: 10px 0 5px; font-weight: bold; font-size: 0.9rem;">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ù„ÙƒÙ„ Ù…Ù‚Ø§Ø³:</p>
            <div class="size-grid">
                <input id="qs" type="number" placeholder="ÙƒÙ…ÙŠØ© S">
                <input id="qm" type="number" placeholder="ÙƒÙ…ÙŠØ© M">
                <input id="ql" type="number" placeholder="ÙƒÙ…ÙŠØ© L">
                <input id="qxl" type="number" placeholder="ÙƒÙ…ÙŠØ© XL">
            </div>

            <div id="drop-zone" onclick="document.getElementById('fileInp').click()">
                <i class="fas fa-image fa-2x"></i><br>Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±
                <input type="file" id="fileInp" hidden onchange="handleFile(this.files[0])">
                <img id="preview">
            </div>
            
            <button class="btn-p" style="margin-top:15px;" onclick="uploadProduct()">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±</button>
        </div>

        <div class="box">
            <h2><i class="fas fa-shopping-cart"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­ÙŠØ©</h2>
            <div id="ordersArea"></div>
        </div>
    </div>

<script>
    const firebaseConfig = { databaseURL: "https://authen-36a1f-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let b64 = "";

    // Image Handling
    function handleFile(f) {
        if(!f) return;
        const reader = new FileReader();
        reader.onload = e => { 
            b64 = e.target.result; 
            document.getElementById('preview').src = b64; 
            document.getElementById('preview').style.display = "block"; 
        };
        reader.readAsDataURL(f);
    }

    // Add Product
    function uploadProduct() {
        const name = document.getElementById('n').value;
        const price = document.getElementById('pr').value;
        const s = parseInt(document.getElementById('qs').value || 0);
        const m = parseInt(document.getElementById('qm').value || 0);
        const l = parseInt(document.getElementById('ql').value || 0);
        const xl = parseInt(document.getElementById('qxl').value || 0);

        if(!name || !price || !b64) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±Ø©");

        db.ref('inventory').push({
            name, price, s, m, l, xl, img: b64, timestamp: Date.now()
        }).then(() => {
            alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬!");
            location.reload();
        });
    }

    // Load Orders & Stats
    db.ref('orders').on('value', snap => {
        const area = document.getElementById('ordersArea');
        let income = 0, count = 0, itemsCount = 0;
        area.innerHTML = '';

        if(!snap.exists()) area.innerHTML = "<p style='text-align:center; color:#94a3b8;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>";

        snap.forEach(child => {
            const order = child.val();
            const id = child.key;

            income += parseFloat(order.total);
            count++;
            
            let orderItemsHtml = "";
            order.items.forEach(item => {
                itemsCount += item.qty;
                orderItemsHtml += `
                    <div class="item-row">
                        <span>${item.name} <b>[${item.sz.toUpperCase()}]</b></span>
                        <span style="color:var(--p)">${item.qty}x</span>
                    </div>`;
            });

            area.innerHTML += `
                <div class="order-card">
                    <div style="display:flex; justify-content:space-between; align-items:start;">
                        <div>
                            <b style="font-size:1.1rem;">${order.name}</b><br>
                            <small>${order.phone}</small>
                        </div>
                        <span class="badge ${order.status === 'pending' ? 'badge-pending' : 'badge-done'}">
                            ${order.status === 'pending' ? 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' : 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„'}
                        </span>
                    </div>
                    
                    <div style="margin:15px 0;">${orderItemsHtml}</div>
                    
                    <div style="font-size:0.9rem; color:#475569; margin-bottom:10px;">
                        <i class="fas fa-map-marker-alt"></i> ${order.addr}
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <b style="color:var(--green); font-size:1.2rem;">$${order.total}</b>
                        <a href="${order.gps}" target="_blank" style="color:var(--p); text-decoration:none; font-size:0.9rem;">ğŸ“ ÙØªØ­ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
                    </div>

                    <div class="actions">
                        ${order.status === 'pending' ? 
                            `<button class="btn-success" onclick="markDone('${id}')">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„ (ÙØªØ­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…)</button>` : 
                            `<button class="btn-success" style="opacity:0.5" disabled>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­</button>`
                        }
                        <button class="btn-danger" onclick="deleteOrder('${id}')"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`;
        });

        document.getElementById('totalMoney').innerText = `$${income.toFixed(2)}`;
        document.getElementById('totalOrders').innerText = count;
        document.getElementById('totalItems').innerText = itemsCount;
    });

    function markDone(id) {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„ØŸ Ù‡Ø°Ø§ Ø³ÙŠØ³Ù…Ø­ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¨ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬.")) {
            db.ref('orders/' + id).update({ status: 'delivered' });
        }
    }

    function deleteOrder(id) {
        if(confirm("Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            db.ref('orders/' + id).remove();
        }
    }

    // Drag & Drop Support
    const dz = document.getElementById('drop-zone');
    dz.ondragover = e => { e.preventDefault(); dz.style.background = "#e0e7ff"; };
    dz.ondragleave = () => dz.style.background = "#f8fafc";
    dz.ondrop = e => {
        e.preventDefault();
        dz.style.background = "#f8fafc";
        handleFile(e.dataTransfer.files[0]);
    };
</script>
</body>
</html>
