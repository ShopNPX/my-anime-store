<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>NPX Admin - Smart Upload</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --p: #6366f1; --dark: #0f172a; }
        body { font-family: sans-serif; background: #f1f5f9; padding: 20px; direction: rtl; }
        .section { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 600px; margin: auto; }
        
        /* منطقة السحب والإفلات */
        #drop-zone {
            border: 2px dashed var(--p);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            color: var(--p);
            cursor: pointer;
            transition: 0.3s;
            margin: 15px 0;
            background: #f0f7ff;
        }
        #drop-zone.hover { background: var(--p); color: white; border-color: white; }
        #preview-img { width: 100%; max-height: 200px; object-fit: contain; display: none; margin-top: 10px; border-radius: 8px; }
        
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; }
        .btn-add { background: var(--p); color: white; border: none; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="section">
    <h2><i class="fas fa-plus-circle"></i> إضافة منتج ذكي</h2>
    
    <input type="text" id="pName" placeholder="اسم المنتج">
    <input type="number" id="pPrice" placeholder="السعر ($)">
    <input type="number" id="pQty" placeholder="الكمية">
    
    <div id="drop-zone" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)" onclick="document.getElementById('fileInput').click()">
        <i class="fas fa-cloud-upload-alt fa-2x"></i>
        <p id="drop-text">اسحب صورة المنتج هنا أو اضغط للرفع</p>
        <img id="preview-img" src="">
        <input type="file" id="fileInput" hidden accept="image/*" onchange="processFile(this.files[0])">
    </div>

    <button class="btn-add" onclick="addProduct()">حفظ المنتج ونشره</button>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://authen-36a1f-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let base64Image = ""; // سيتم تخزين كود الصورة هنا

    // --- منطق السحب والإفلات ---
    function handleDragOver(e) {
        e.preventDefault();
        document.getElementById('drop-zone').classList.add('hover');
    }

    function handleDragLeave(e) {
        document.getElementById('drop-zone').classList.remove('hover');
    }

    function handleDrop(e) {
        e.preventDefault();
        document.getElementById('drop-zone').classList.remove('hover');
        const file = e.dataTransfer.files[0];
        processFile(file);
    }

    // معالجة الصورة وتحويلها لـ Base64
    function processFile(file) {
        if (!file || !file.type.startsWith('image/')) return alert("يرجى رفع ملف صورة فقط!");
        
        const reader = new FileReader();
        reader.onload = function(e) {
            base64Image = e.target.result;
            const img = document.getElementById('preview-img');
            img.src = base64Image;
            img.style.display = "block";
            document.getElementById('drop-text').style.display = "none";
        };
        reader.readAsDataURL(file);
    }

    // --- إضافة المنتج لقاعدة البيانات ---
    function addProduct() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const qty = parseInt(document.getElementById('pQty').value);

        if (!name || !price || !qty || !base64Image) {
            return alert("تأكد من إدخال كافة البيانات ورفع الصورة!");
        }

        db.ref('inventory').push({
            name,
            price,
            qty,
            img: base64Image, // يتم حفظ الصورة ككود نصي طويل
            category: "عام"
        }).then(() => {
            alert("تم رفع المنتج بنجاح!");
            location.reload(); // إعادة تحميل لتصفير الحقول
        });
    }
</script>
</body>
</html>
