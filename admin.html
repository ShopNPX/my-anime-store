<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>NPX Admin - Control Panel</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #f1f5f9; padding: 20px; direction: rtl; }
        .box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        #drop-zone { border: 2px dashed #6366f1; padding: 30px; text-align: center; border-radius: 10px; cursor: pointer; background: #f8fafc; margin: 10px 0; color: #6366f1; }
        #drop-zone.hover { background: #e0e7ff; }
        img#preview { max-height: 150px; display: none; margin: 10px auto; border-radius: 8px; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        .btn-main { background: #6366f1; color: white; border: none; font-weight: bold; cursor: pointer; }
        .order { border-right: 5px solid #6366f1; padding: 15px; background: white; margin-bottom: 10px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="box" style="max-width: 500px; margin: auto;">
    <h2>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª</h2>
    <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
    <input type="number" id="pQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
    
    <div id="drop-zone" ondragover="event.preventDefault(); this.classList.add('hover')" ondragleave="this.classList.remove('hover')" ondrop="handleDrop(event)">
        Ø§Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§
        <img id="preview" src="">
    </div>
    
    <button class="btn-main" onclick="upload()">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
</div>

<div id="ordersArea" style="max-width: 800px; margin: 20px auto;">
    <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
    <div id="list"></div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://authen-36a1f-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let base64 = "";

    function handleDrop(e) {
        e.preventDefault();
        this.classList.remove('hover');
        const file = e.dataTransfer.files[0];
        const reader = new FileReader();
        reader.onload = (ev) => {
            base64 = ev.target.result;
            const img = document.getElementById('preview');
            img.src = base64; img.style.display = "block";
        };
        reader.readAsDataURL(file);
    }

    function upload() {
        const name = document.getElementById('pName').value, price = document.getElementById('pPrice').value, qty = document.getElementById('pQty').value;
        if(!base64 || !name) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        db.ref('inventory').push({ name, price, qty: parseInt(qty), img: base64 });
        alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±!"); location.reload();
    }

    db.ref('orders').on('value', snap => {
        const area = document.getElementById('list');
        area.innerHTML = '';
        snap.forEach(c => {
            const o = c.val();
            area.innerHTML += `
                <div class="order">
                    <b>${o.name} - ${o.phone}</b> | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: $${o.total}<br>
                    <p>${o.items.map(i=>i.name).join(' + ')}</p>
                    <a href="${o.location}" target="_blank">ğŸ“ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a><br><br>
                    ${o.status === 'pending' ? 
                        `<button onclick="done('${c.key}')" style="background:green; color:white; border:none; padding:8px; border-radius:5px; cursor:pointer;">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ (ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…)</button>` : 
                        '<span>âœ… Ø·Ù„Ø¨ Ù…ÙƒØªÙ…Ù„</span>'}
                    <button onclick="db.ref('orders/${c.key}').remove()" style="background:red; color:white; border:none; padding:8px; border-radius:5px; cursor:pointer;">Ø­Ø°Ù</button>
                </div>
            `;
        });
    });

    function done(id) { db.ref('orders/' + id).update({ status: 'delivered' }); }
</script>
</body>
</html>
