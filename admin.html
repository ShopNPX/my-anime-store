<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPX Admin - Ultimate Dashboard 2026</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --p: #6366f1; --dark: #0f172a; --bg: #f1f5f9; --white: #ffffff; --red: #ef4444; --green: #22c55e; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; direction: rtl; }
        
        /* Dashboard Stats */
        .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-box { background: var(--white); padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-bottom: 4px solid var(--p); transition: 0.3s; }
        .stat-box:hover { transform: translateY(-5px); }
        .stat-box h2 { margin: 10px 0; font-size: 2rem; color: var(--dark); }
        .stat-box i { color: var(--p); font-size: 1.5rem; }

        .main-container { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; }
        @media (max-width: 1000px) { .main-container { grid-template-columns: 1fr; } }

        .box { background: var(--white); padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: var(--dark); border-bottom: 2px solid var(--bg); padding-bottom: 10px; }

        /* Form Styles */
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; outline: none; box-sizing: border-box; font-size: 1rem; }
        .btn-p { background: var(--p); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-p:hover { background: #4f46e5; }

        /* Drop Zone */
        #drop-zone { border: 2px dashed var(--p); padding: 30px; text-align: center; border-radius: 12px; cursor: pointer; background: #f8fafc; margin: 15px 0; color: #64748b; }
        #drop-zone i { font-size: 3rem; margin-bottom: 10px; display: block; }
        #preview { max-width: 100%; border-radius: 10px; display: none; margin-top: 15px; border: 1px solid #ddd; }

        /* Order Cards */
        .order-card { background: var(--white); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-right: 6px solid var(--p); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .order-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .items-list { background: #f8fafc; padding: 15px; border-radius: 10px; margin: 10px 0; border: 1px solid #e2e8f0; }
        .item-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dashed #cbd5e1; }
        .item-row:last-child { border-bottom: none; }
        
        .map-snap { width: 100%; height: 160px; background: #e2e8f0; border-radius: 10px; margin: 15px 0; overflow: hidden; display: flex; align-items: center; justify-content: center; position: relative; }
        .map-snap img { width: 100%; height: 100%; object-fit: cover; }
        
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .badge-pending { background: #fef3c7; color: #92400e; }
        .badge-done { background: #dcfce7; color: #166534; }

        .actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-done { background: var(--green); flex: 2; }
        .btn-del { background: var(--red); flex: 1; }
    </style>
</head>
<body>

    <div class="stats-bar">
        <div class="stat-box">
            <i class="fas fa-wallet"></i>
            <h3>إجمالي المبيعات</h3>
            <h2 id="stMoney">$0</h2>
        </div>
        <div class="stat-box">
            <i class="fas fa-box"></i>
            <h3>إجمالي الطلبات</h3>
            <h2 id="stOrders">0</h2>
        </div>
        <div class="stat-box">
            <i class="fas fa-tshirt"></i>
            <h3>القطع المباعة</h3>
            <h2 id="stItems">0</h2>
        </div>
    </div>

    <div class="main-container">
        <div class="box">
            <h2><i class="fas fa-plus-circle"></i> إضافة منتج جديد</h2>
            <input id="prodName" type="text" placeholder="اسم المنتج (مثال: هودي أسود نينجا)">
            <input id="prodPrice" type="number" placeholder="السعر بالدولار $">
            <input id="prodQty" type="number" placeholder="الكمية المتوفرة بالمخزن">
            
            <label style="font-size: 0.9rem; color: #64748b;">التصنيف:</label>
            <select id="prodCat">
                <option value="تيشيرت">تيشيرت</option>
                <option value="هودي">هودي</option>
                <option value="إكسسوارات">إكسسوارات</option>
            </select>

            <div id="drop-zone" ondragover="event.preventDefault(); this.style.background='#e0e7ff'" ondragleave="this.style.background='#f8fafc'" ondrop="handleDrop(event)">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>اسحب صورة المنتج هنا أو انقر للإضافة</span>
                <img id="preview">
            </div>
            
            <button class="btn-p" onclick="addProduct()">نشر المنتج في المتجر <i class="fas fa-paper-plane"></i></button>
        </div>

        <div class="box">
            <h2><i class="fas fa-truck-loading"></i> إدارة الطلبات الحية</h2>
            <div id="ordersList">
                <p style="text-align: center; color: #94a3b8;">جاري تحميل الطلبات...</p>
            </div>
        </div>
    </div>

<script>
    // Configuration
    const firebaseConfig = { databaseURL: "https://authen-36a1f-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let base64Image = "";

    // Image Upload Logic
    function handleDrop(e) {
        e.preventDefault();
        const file = e.dataTransfer ? e.dataTransfer.files[0] : e.target.files[0];
        if (!file.type.match('image.*')) return alert("يرجى اختيار صورة فقط");
        
        const reader = new FileReader();
        reader.onload = (event) => {
            base64Image = event.target.result;
            const preview = document.getElementById('preview');
            preview.src = base64Image;
            preview.style.display = "block";
            document.querySelector('#drop-zone span').style.display = "none";
        };
        reader.readAsDataURL(file);
    }

    // Add Product to Firebase
    function addProduct() {
        const name = document.getElementById('prodName').value;
        const price = document.getElementById('prodPrice').value;
        const qty = document.getElementById('prodQty').value;
        const cat = document.getElementById('prodCat').value;

        if(!name || !price || !qty || !base64Image) {
            return alert("يرجى ملء جميع الحقول واختيار صورة");
        }

        db.ref('inventory').push({
            name: name,
            price: price,
            qty: parseInt(qty),
            category: cat,
            img: base64Image,
            timestamp: Date.now()
        }).then(() => {
            alert("تم إضافة المنتج بنجاح!");
            location.reload();
        });
    }

    // Real-time Orders Sync
    db.ref('orders').on('value', snap => {
        const container = document.getElementById('ordersList');
        let totalMoney = 0, totalOrders = 0, totalItems = 0;
        
        if(!snap.exists()) {
            container.innerHTML = '<p style="text-align: center; color: #94a3b8;">لا توجد طلبات حالياً</p>';
            return;
        }

        container.innerHTML = '';
        snap.forEach(child => {
            const order = child.val();
            const orderId = child.key;

            totalMoney += parseFloat(order.total);
            totalOrders++;
            totalItems += order.items.length;

            // Simple map preview if coordinates exist
            let mapDisplay = `<i class="fas fa-map-marked-alt fa-2x"></i> <span>الموقع الجغرافي مرفق</span>`;
            
            container.innerHTML += `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <strong style="font-size:1.1rem;">${order.name}</strong><br>
                            <small style="color:#64748b;"><i class="fab fa-whatsapp"></i> ${order.phone}</small>
                        </div>
                        <span class="badge ${order.status === 'pending' ? 'badge-pending' : 'badge-done'}">
                            ${order.status === 'pending' ? 'قيد الانتظار' : 'مكتمل'}
                        </span>
                    </div>

                    <div class="items-list">
                        <strong>الأصناف المطلوبة:</strong>
                        ${order.items.map(item => `
                            <div class="item-row">
                                <span>${item.name} <b style="color:var(--p)">[${item.selectedSize}]</b></span>
                                <span>$${item.price}</span>
                            </div>
                        `).join('')}
                        <div style="text-align:left; margin-top:10px; font-weight:bold; color:var(--green);">
                            الإجمالي: $${order.total}
                        </div>
                    </div>

                    <div style="font-size:0.9rem; margin-bottom:10px;">
                        <i class="fas fa-home"></i> <b>العنوان:</b> ${order.addr}
                    </div>

                    <div class="map-snap">
                        <a href="${order.location}" target="_blank" style="text-decoration:none; color:inherit; display:flex; flex-direction:column; align-items:center;">
                            ${mapDisplay}
                            <br><small>اضغط لفتح خرائط جوجل</small>
                        </a>
                    </div>

                    <div class="actions">
                        ${order.status === 'pending' ? 
                            `<button class="btn-p btn-done" onclick="completeOrder('${orderId}')">تأكيد التوصيل وفتح التقييم</button>` : 
                            `<button class="btn-p" style="background:#94a3b8; cursor:default;" disabled>تم التوصيل ✅</button>`
                        }
                        <button class="btn-p btn-del" onclick="deleteOrder('${orderId}')"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `;
        });

        // Update Stats Bar
        document.getElementById('stMoney').innerText = `$${totalMoney.toFixed(2)}`;
        document.getElementById('stOrders').innerText = totalOrders;
        document.getElementById('stItems').innerText = totalItems;
    });

    // Mark Order as Delivered
    function completeOrder(id) {
        if(confirm("هل تم تسليم الطلب بالفعل؟ سيتم فتح نظام التقييم للعميل الآن.")) {
            db.ref('orders/' + id).update({ status: 'delivered' });
        }
    }

    // Delete Order
    function deleteOrder(id) {
        if(confirm("هل أنت متأكد من حذف هذا الطلب نهائياً من السجلات؟")) {
            db.ref('orders/' + id).remove();
        }
    }

    // Click to upload also
    document.getElementById('drop-zone').onclick = () => {
        let input = document.createElement('input');
        input.type = 'file';
        input.onchange = handleDrop;
        input.click();
    };
</script>
</body>
</html>
