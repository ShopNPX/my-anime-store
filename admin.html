<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>NPX Admin Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; direction: rtl; }
        .card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        input, select { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 8px; }
        .btn-add { background: #6366f1; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; width: 100%; }
        .item-list { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0; }
        .btn-del { background: #ef4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© NPX</h1>

    <div class="grid">
        <div class="card">
            <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
            <input id="n" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input id="p" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
            <input id="q" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
            <select id="c">
                <option value="ØªÙŠØ´ÙŠØ±Øª">ØªÙŠØ´ÙŠØ±Øª</option>
                <option value="Ù‡ÙˆØ¯ÙŠ">Ù‡ÙˆØ¯ÙŠ</option>
                <option value="Ø¥ÙƒØ³Ø³ÙˆØ§Ø±">Ø¥ÙƒØ³Ø³ÙˆØ§Ø±</option>
            </select>
            <input id="i" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
            <button class="btn-add" onclick="addItem()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ¬Ø±</button>
        </div>

        <div class="card">
            <h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ (ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù)</h3>
            <div id="invList"></div>
        </div>
    </div>

    <h1>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© (GPS)</h1>
    <div id="orderList"></div>

<script>
    const firebaseConfig = { databaseURL: "https://authen-36a1f-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function addItem() {
        const n=document.getElementById('n').value, p=document.getElementById('p').value, q=document.getElementById('q').value, c=document.getElementById('c').value, i=document.getElementById('i').value;
        db.ref('inventory').push({ name:n, price:p, qty:parseInt(q), category:c, img:i });
        alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!");
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ø¹ Ø§Ù„ØªØ­ÙƒÙ…
    db.ref('inventory').on('value', snap => {
        const list = document.getElementById('invList');
        list.innerHTML = '';
        snap.forEach(child => {
            const p = child.val();
            list.innerHTML += `
                <div class="item-list">
                    <span>${p.name} (Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${p.qty})</span>
                    <div>
                        <button onclick="updateQty('${child.key}', 1)">+</button>
                        <button onclick="updateQty('${child.key}', -1)">-</button>
                        <button class="btn-del" onclick="db.ref('inventory/${child.key}').remove()">Ø­Ø°Ù</button>
                    </div>
                </div>
            `;
        });
    });

    function updateQty(id, change) {
        db.ref(`inventory/${id}/qty`).get().then(s => {
            db.ref(`inventory/${id}`).update({ qty: Math.max(0, s.val() + change) });
        });
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    db.ref('orders').on('value', snap => {
        const list = document.getElementById('orderList');
        list.innerHTML = '';
        snap.forEach(child => {
            const o = child.val();
            list.innerHTML += `
                <div class="card">
                    <h4>Ø§Ù„Ø¹Ù…ÙŠÙ„: ${o.name} - Ø§Ù„Ù‡Ø§ØªÙ: ${o.phone}</h4>
                    <p>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${o.items.map(i=>i.name).join(', ')}</p>
                    <a href="${o.location}" target="_blank" style="color:blue">ğŸ“ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a><br><br>
                    <button class="btn-del" style="background:#22c55e" onclick="db.ref('orders/${child.key}').remove()">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ / Ù…Ø³Ø­</button>
                </div>
            `;
        });
    });
</script>
</body>
</html>
